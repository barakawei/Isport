(function(b){var a;b.rails=a={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required],textarea[name][required]",fileInputSelector:"input:file",CSRFProtection:function(d){var c=b('meta[name="csrf-token"]').attr("content");if(c){d.setRequestHeader("X-CSRF-Token",c)}},fire:function(f,c,e){var d=b.Event(c);f.trigger(d,e);return d.result!==false},confirm:function(c){return confirm(c)},ajax:function(c){return b.ajax(c)},handleRemote:function(f){var h,e,g,c=f.data("type")||(b.ajaxSettings&&b.ajaxSettings.dataType);if(a.fire(f,"ajax:before")){if(f.is("form")){h=f.attr("method");e=f.attr("action");g=f.serializeArray();var d=f.data("ujs:submit-button");if(d){g.push(d);f.data("ujs:submit-button",null)}}else{h=f.data("method");e=f.attr("href");g=null}a.ajax({url:e,type:h||"GET",data:g,dataType:c,beforeSend:function(j,i){if(i.dataType===undefined){j.setRequestHeader("accept","*/*;q=0.5, "+i.accepts.script)}return a.fire(f,"ajax:beforeSend",[j,i])},success:function(j,i,k){f.trigger("ajax:success",[j,i,k])},complete:function(j,i){f.trigger("ajax:complete",[j,i])},error:function(k,j,i){f.trigger("ajax:error",[k,j,i])}})}},handleMethod:function(f){var c=f.attr("href"),h=f.data("method"),d=b("meta[name=csrf-token]").attr("content"),i=b("meta[name=csrf-param]").attr("content"),e=b('<form method="post" action="'+c+'"></form>'),g='<input name="_method" value="'+h+'" type="hidden" />';if(i!==undefined&&d!==undefined){g+='<input name="'+i+'" value="'+d+'" type="hidden" />'}e.hide().append(g).appendTo("body");e.submit()},disableFormElements:function(c){c.find(a.disableSelector).each(function(){var d=b(this),e=d.is("button")?"html":"val";d.data("ujs:enable-with",d[e]());d[e](d.data("disable-with"));d.attr("disabled","disabled")})},enableFormElements:function(c){c.find(a.enableSelector).each(function(){var d=b(this),e=d.is("button")?"html":"val";if(d.data("ujs:enable-with")){d[e](d.data("ujs:enable-with"))}d.removeAttr("disabled")})},allowAction:function(d){var e=d.data("confirm"),c=false,f;if(!e){return true}if(a.fire(d,"confirm")){c=a.confirm(e);f=a.fire(d,"confirm:complete",[c])}return c&&f},blankInputs:function(h,d,f){var g=b(),e,c=d||"input,textarea";h.find(c).each(function(){e=b(this);if(f?e.val():!e.val()){g=g.add(e)}});return g.length?g:false},nonBlankInputs:function(d,c){return a.blankInputs(d,c,true)},stopEverything:function(c){c.stopImmediatePropagation();return false},callFormSubmitBindings:function(d){var c=d.data("events"),e=true;if(c!==undefined&&c.submit!==undefined){b.each(c.submit,function(f,g){if(typeof g.handler==="function"){return e=g.handler(g.data)}})}return e}};if("ajaxPrefilter" in b){b.ajaxPrefilter(function(c,d,e){a.CSRFProtection(e)})}else{b(document).ajaxSend(function(c,d){a.CSRFProtection(d)})}b(a.linkClickSelector).live("click.rails",function(d){var c=b(this);if(!a.allowAction(c)){return a.stopEverything(d)}if(c.data("remote")!==undefined){a.handleRemote(c);return false}else{if(c.data("method")){a.handleMethod(c);return false}}});b(a.formSubmitSelector).live("submit.rails",function(h){var f=b(this),c=f.data("remote")!==undefined,d=a.blankInputs(f,a.requiredInputSelector),g=a.nonBlankInputs(f,a.fileInputSelector);if(!a.allowAction(f)){return a.stopEverything(h)}if(d&&a.fire(f,"ajax:aborted:required",[d])){return !c}if(c){if(g){return a.fire(f,"ajax:aborted:file",[g])}if(!b.support.submitBubbles&&a.callFormSubmitBindings(f)===false){return a.stopEverything(h)}a.handleRemote(f);return false}else{setTimeout(function(){a.disableFormElements(f)},13)}});b(a.formInputClickSelector).live("click.rails",function(e){var d=b(this);if(!a.allowAction(d)){return a.stopEverything(e)}var c=d.attr("name"),f=c?{name:c,value:d.val()}:null;d.closest("form").data("ujs:submit-button",f)});b(a.formSubmitSelector).live("ajax:beforeSend.rails",function(c){if(this==c.target){a.disableFormElements(b(this))}});b(a.formSubmitSelector).live("ajax:complete.rails",function(c){if(this==c.target){a.enableFormElements(b(this))}})})(jQuery);var qq=qq||{};qq.extend=function(b,a){for(var c in a){b[c]=a[c]}};qq.indexOf=function(b,c,d){if(b.indexOf){return b.indexOf(c,d)}d=d||0;var a=b.length;if(d<0){d+=a}for(;d<a;d++){if(d in b&&b[d]===c){return d}}return -1};qq.getUniqueId=(function(){var a=0;return function(){return a++}})();qq.attach=function(a,c,b){if(a.addEventListener){a.addEventListener(c,b,false)}else{if(a.attachEvent){a.attachEvent("on"+c,b)}}};qq.detach=function(a,c,b){if(a.removeEventListener){a.removeEventListener(c,b,false)}else{if(a.attachEvent){a.detachEvent("on"+c,b)}}};qq.preventDefault=function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};qq.insertBefore=function(d,c){c.parentNode.insertBefore(d,c)};qq.remove=function(a){a.parentNode.removeChild(a)};qq.contains=function(b,a){if(b==a){return true}if(b.contains){return b.contains(a)}else{return !!(a.compareDocumentPosition(b)&8)}};qq.toElement=(function(){var a=document.createElement("div");return function(c){a.innerHTML=c;var b=a.firstChild;a.removeChild(b);return b}})();qq.css=function(b,a){if(a.opacity!==null){if(typeof b.style.opacity!="string"&&typeof(b.filters)!="undefined"){a.filter="alpha(opacity="+Math.round(100*a.opacity)+")"}}qq.extend(b.style,a)};qq.hasClass=function(b,a){var c=new RegExp("(^| )"+a+"( |$)");return c.test(b.className)};qq.addClass=function(b,a){if(!qq.hasClass(b,a)){b.className+=" "+a}};qq.removeClass=function(b,a){var c=new RegExp("(^| )"+a+"( |$)");b.className=b.className.replace(c," ").replace(/^\s+|\s+$/g,"")};qq.setText=function(a,b){a.innerText=b;a.textContent=b};qq.children=function(a){var b=[],c=a.firstChild;while(c){if(c.nodeType==1){b.push(c)}c=c.nextSibling}return b};qq.getByClass=function(d,c){if(d.querySelectorAll){return d.querySelectorAll("."+c)}var f=[];var b=d.getElementsByTagName("*");var a=b.length;for(var e=0;e<a;e++){if(qq.hasClass(b[e],c)){f.push(b[e])}}return f};qq.obj2url=function(h,c,g){var f=[],b="&",e=function(k,j){var l=c?(/\[\]$/.test(c))?c:c+"["+j+"]":j;if((l!="undefined")&&(j!="undefined")){f.push((typeof k==="object")?qq.obj2url(k,l,true):(Object.prototype.toString.call(k)==="[object Function]")?encodeURIComponent(l)+"="+encodeURIComponent(k()):encodeURIComponent(l)+"="+encodeURIComponent(k))}};if(!g&&c){b=(/\?/.test(c))?(/\?$/.test(c))?"":"&":"?";f.push(c);f.push(qq.obj2url(h))}else{if((Object.prototype.toString.call(h)==="[object Array]")&&(typeof h!="undefined")){for(var d=0,a=h.length;d<a;++d){e(h[d],d)}}else{if((typeof h!="undefined")&&(h!==null)&&(typeof h==="object")){for(var d in h){e(h[d],d)}}else{f.push(encodeURIComponent(c)+"="+encodeURIComponent(h))}}}return f.join(b).replace(/^&/,"").replace(/%20/g,"+")};var qq=qq||{};qq.FileUploaderBasic=function(a){this._options={debug:false,action:"/server/upload",params:{},button:null,multiple:true,maxConnections:3,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,onSubmit:function(c,b){},onProgress:function(e,d,b,c){},onComplete:function(d,b,c){},onAllComplete:function(b){},onCancel:function(c,b){},messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},showMessage:function(b){alert(b)}};qq.extend(this._options,a);this._filesInProgress=0;this._handler=this._createUploadHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button)}this._preventLeaveInProgress()};qq.FileUploaderBasic.prototype={setParams:function(a){this._options.params=a},getInProgress:function(){return this._filesInProgress},_createUploadButton:function(b){var a=this;return new qq.UploadButton({element:b,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),onChange:function(c){a._onInputChange(c)}})},_createUploadHandler:function(){var b=this,a;if(qq.UploadHandlerXhr.isSupported()){a="UploadHandlerXhr"}else{a="UploadHandlerForm"}var c=new qq[a]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(g,f,d,e){b._onProgress(g,f,d,e);b._options.onProgress(g,f,d,e)},onComplete:function(f,e,d){b._onComplete(f,e,d);b._options.onComplete(f,e,d)},onAllComplete:function(d){b._options.onAllComplete(d)},onCancel:function(e,d){b._onCancel(e,d);b._options.onCancel(e,d)}});return c},_preventLeaveInProgress:function(){var a=this;qq.attach(window,"beforeunload",function(b){if(!a._filesInProgress){return}var b=b||window.event;b.returnValue=a._options.messages.onLeave;return a._options.messages.onLeave})},_onSubmit:function(b,a){this._filesInProgress++},_onProgress:function(d,c,a,b){},_onComplete:function(c,b,a){this._filesInProgress--;if(a.error){this._options.showMessage(a.error)}},_onCancel:function(b,a){this._filesInProgress--},_onInputChange:function(a){if(this._handler instanceof qq.UploadHandlerXhr){this._uploadFileList(a.files)}else{if(this._validateFile(a)){this._uploadFile(a)}}this._button.reset()},_uploadFileList:function(b){for(var a=0;a<b.length;a++){if(!this._validateFile(b[a])){return}}for(var a=0;a<b.length;a++){this._uploadFile(b[a])}},_uploadFile:function(a){var c=this._handler.add(a);var b=this._handler.getName(c);if(this._options.onSubmit(c,b)!==false){this._onSubmit(c,b);this._handler.upload(c,this._options.params)}},_validateFile:function(c){var a,b;if(c.value){a=c.value.replace(/.*(\/|\\)/,"")}else{a=c.fileName!=null?c.fileName:c.name;b=c.fileSize!=null?c.fileSize:c.size}if(!this._isAllowedExtension(a)){this._error("typeError",a);return false}else{if(b===0){this._error("emptyError",a);return false}else{if(b&&this._options.sizeLimit&&b>this._options.sizeLimit){this._error("sizeError",a);return false}else{if(b&&b<this._options.minSizeLimit){this._error("minSizeError",a);return false}}}}return true},_error:function(c,d){var b=this._options.messages[c];function a(e,f){b=b.replace(e,f)}a("{file}",this._formatFileName(d));a("{extensions}",this._options.allowedExtensions.join(", "));a("{sizeLimit}",this._formatSize(this._options.sizeLimit));a("{minSizeLimit}",this._formatSize(this._options.minSizeLimit));this._options.showMessage(b)},_formatFileName:function(a){if(a.length>33){a=a.slice(0,19)+"..."+a.slice(-13)}return a},_isAllowedExtension:function(c){var b=(-1!==c.indexOf("."))?c.replace(/.*[.]/,"").toLowerCase():"";var d=this._options.allowedExtensions;if(!d.length){return true}for(var a=0;a<d.length;a++){if(d[a].toLowerCase()==b){return true}}return false},_formatSize:function(a){var b=-1;do{a=a/1024;b++}while(a>99);return Math.max(a,0.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][b]}};qq.FileUploader=function(a){qq.FileUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,template:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>Drop files here to upload</span></div><div class="qq-upload-button">Upload a file</div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a><span class="qq-upload-failed-text">Failed</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"}});qq.extend(this._options,a);this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;this._button=this._createUploadButton(this._find(this._element,"button"));this._bindCancelEvent();this._setupDragDrop()};qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype);qq.extend(qq.FileUploader.prototype,{_find:function(a,c){var b=qq.getByClass(a,this._options.classes[c])[0];if(!b){throw new Error("element not found "+c)}return b},_setupDragDrop:function(){var b=this,c=this._find(this._element,"drop");var a=new qq.UploadDropZone({element:c,onEnter:function(d){qq.addClass(c,b._classes.dropActive);d.stopPropagation()},onLeave:function(d){d.stopPropagation()},onLeaveNotDescendants:function(d){qq.removeClass(c,b._classes.dropActive)},onDrop:function(d){c.style.display="none";qq.removeClass(c,b._classes.dropActive);b._uploadFileList(d.dataTransfer.files)}});c.style.display="none";qq.attach(document,"dragenter",function(d){if(!a._isValidFileDrag(d)){return}c.style.display="block"});qq.attach(document,"dragleave",function(f){if(!a._isValidFileDrag(f)){return}var d=document.elementFromPoint(f.clientX,f.clientY);if(!d||d.nodeName=="HTML"){c.style.display="none"}})},_onSubmit:function(b,a){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(b,a)},_onProgress:function(g,e,b,d){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var c=this._getItemByFileId(g);var a=this._find(c,"size");a.style.display="inline";var f;if(b!=d){f=Math.round(b/d*100)+"% from "+this._formatSize(d)}else{f=this._formatSize(d)}qq.setText(a,f)},_onComplete:function(d,c,b){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var a=this._getItemByFileId(d);qq.remove(this._find(a,"cancel"));qq.remove(this._find(a,"spinner"));if(b.success){qq.addClass(a,this._classes.success)}else{qq.addClass(a,this._classes.fail)}},_addToList:function(d,c){var a=qq.toElement(this._options.fileTemplate);a.qqFileId=d;var b=this._find(a,"file");qq.setText(b,this._formatFileName(c));this._find(a,"size").style.display="none";this._listElement.appendChild(a)},_getItemByFileId:function(b){var a=this._listElement.firstChild;while(a){if(a.qqFileId==b){return a}a=a.nextSibling}},_bindCancelEvent:function(){var a=this,b=this._listElement;qq.attach(b,"click",function(d){d=d||window.event;var f=d.target||d.srcElement;if(qq.hasClass(f,a._classes.cancel)){qq.preventDefault(d);var c=f.parentNode;a._handler.cancel(c.qqFileId);qq.remove(c)}})}});qq.UploadDropZone=function(a){this._options={element:null,onEnter:function(b){},onLeave:function(b){},onLeaveNotDescendants:function(b){},onDrop:function(b){}};qq.extend(this._options,a);this._element=this._options.element;this._disableDropOutside();this._attachEvents()};qq.UploadDropZone.prototype={_disableDropOutside:function(a){if(!qq.UploadDropZone.dropOutsideDisabled){qq.attach(document,"dragover",function(b){if(b.dataTransfer){b.dataTransfer.dropEffect="none";b.preventDefault()}});qq.UploadDropZone.dropOutsideDisabled=true}},_attachEvents:function(){var a=this;qq.attach(a._element,"dragover",function(c){if(!a._isValidFileDrag(c)){return}var b=c.dataTransfer.effectAllowed;if(b=="move"||b=="linkMove"){c.dataTransfer.dropEffect="move"}else{c.dataTransfer.dropEffect="copy"}c.stopPropagation();c.preventDefault()});qq.attach(a._element,"dragenter",function(b){if(!a._isValidFileDrag(b)){return}a._options.onEnter(b)});qq.attach(a._element,"dragleave",function(c){if(!a._isValidFileDrag(c)){return}a._options.onLeave(c);var b=document.elementFromPoint(c.clientX,c.clientY);if(qq.contains(this,b)){return}a._options.onLeaveNotDescendants(c)});qq.attach(a._element,"drop",function(b){if(!a._isValidFileDrag(b)){return}b.preventDefault();a._options.onDrop(b)})},_isValidFileDrag:function(c){var a=c.dataTransfer,b=navigator.userAgent.indexOf("AppleWebKit")>-1;return a&&a.effectAllowed!="none"&&(a.files||(!b&&a.types.contains&&a.types.contains("Files")))}};qq.UploadButton=function(a){this._options={element:null,multiple:false,name:"file",onChange:function(b){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,a);this._element=this._options.element;this._input=this._createInput()};qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){if(this._input.parentNode){qq.remove(this._input)}qq.removeClass(this._element,this._options.focusClass);this._input=this._createInput()},_createInput:function(){var b=document.createElement("input");if(this._options.multiple){b.setAttribute("multiple","multiple")}b.setAttribute("type","file");b.setAttribute("name",this._options.name);qq.css(b,{position:"absolute",top:0,fontSize:"50px",opacity:0,right:0});this._element.appendChild(b);var a=this;qq.attach(b,"change",function(){a._options.onChange(b)});qq.attach(b,"mouseover",function(){qq.addClass(a._element,a._options.hoverClass)});qq.attach(b,"mouseout",function(){qq.removeClass(a._element,a._options.hoverClass)});qq.attach(b,"focus",function(){qq.addClass(a._element,a._options.focusClass)});qq.attach(b,"blur",function(){qq.removeClass(a._element,a._options.focusClass)});if(window.attachEvent){b.setAttribute("tabIndex","-1")}return b}};qq.UploadHandlerAbstract=function(a){this._options={debug:false,action:"/upload.php",maxConnections:999,onProgress:function(e,d,b,c){},onComplete:function(d,c,b){},onAllComplete:function(b){},onCancel:function(c,b){}};qq.extend(this._options,a);this._queue=[];this._params=[];this._completed_files=[]};qq.UploadHandlerAbstract.prototype={log:function(a){if(this._options.debug&&window.console){console.log("[uploader] "+a)}},add:function(a){},upload:function(d,b){var a=this._queue.push(d);var c={};qq.extend(c,b);this._params[d]=c;if(a<=this._options.maxConnections){this._upload(d,this._params[d])}},cancel:function(a){this._cancel(a);this._dequeue(a)},cancelAll:function(){for(var a=0;a<this._queue.length;a++){this._cancel(this._queue[a])}this._queue=[]},getName:function(a){},getSize:function(a){},getQueue:function(){return this._queue},_upload:function(a){},_cancel:function(a){},_dequeue:function(d){var c=qq.indexOf(this._queue,d);this._queue.splice(c,1);var a=this._options.maxConnections;if(this._queue.length>=a){var b=this._queue[a-1];this._upload(b,this._params[b])}if(this._queue.length==0){this._onAllComplete()}},_onAllComplete:function(){this._options.onAllComplete(this._completed_files)}};qq.UploadHandlerForm=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={}};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerForm.prototype,{add:function(a){a.setAttribute("name","qqfile");var b="qq-upload-handler-iframe"+qq.getUniqueId();this._inputs[b]=a;if(a.parentNode){qq.remove(a)}return b},getName:function(a){return this._inputs[a].value.replace(/.*(\/|\\)/,"")},_cancel:function(b){this._options.onCancel(b,this.getName(b));delete this._inputs[b];var a=document.getElementById(b);if(a){a.setAttribute("src","javascript:false;");qq.remove(a)}},_upload:function(b,f){var h=this._inputs[b];if(!h){throw new Error("file with passed id was not added, or already uploaded or cancelled")}var e=this.getName(b);var d=this._createIframe(b);var a=this._createForm(d,f);a.appendChild(h);var c=$('meta[name="csrf-param"]').attr("content");var g=$('meta[name="csrf-token"]').attr("content");tokenInput=qq.toElement('<input type="hidden" value="'+g+'" name="'+c+'">');a.appendChild(tokenInput);var i=this;this._attachLoadEvent(d,function(){i.log("iframe loaded");var j=i._getIframeContentJSON(d);i._options.onComplete(b,e,j);i._dequeue(b);delete i._inputs[b];setTimeout(function(){qq.remove(d)},1)});a.submit();qq.remove(a);return b},_attachLoadEvent:function(a,b){qq.attach(a,"load",function(){if(!a.parentNode){return}if(a.contentDocument&&a.contentDocument.body&&a.contentDocument.body.innerHTML=="false"){return}b()})},_getIframeContentJSON:function(iframe){var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+doc.body.innerHTML);try{response=eval("("+doc.body.innerHTML+")")}catch(err){response={}}return response},_createIframe:function(b){var a=qq.toElement('<iframe src="javascript:false;" name="'+b+'" />');a.setAttribute("id",b);a.style.display="none";document.body.appendChild(a);return a},_createForm:function(a,d){var b=qq.toElement('<form method="post" enctype="multipart/form-data"></form>');var c=qq.obj2url(d,this._options.action);b.setAttribute("action",c);b.setAttribute("target",a.name);b.style.display="none";document.body.appendChild(b);return b}});qq.UploadHandlerXhr=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]};qq.UploadHandlerXhr.isSupported=function(){var a=document.createElement("input");a.type="file";return("multiple" in a&&typeof File!="undefined"&&typeof(new XMLHttpRequest()).upload!="undefined")};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerXhr.prototype,{add:function(a){if(!(a instanceof File)){throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)")}return this._files.push(a)-1},getName:function(b){var a=this._files[b];return a.fileName!=null?a.fileName:a.name},getSize:function(b){var a=this._files[b];return a.fileSize!=null?a.fileSize:a.size},getLoaded:function(a){return this._loaded[a]||0},_upload:function(b,e){var c=this._files[b],a=this.getName(b),i=this.getSize(b);this._loaded[b]=0;var h=this._xhrs[b]=new XMLHttpRequest();var g=this;h.upload.onprogress=function(j){if(j.lengthComputable){g._loaded[b]=j.loaded;g._options.onProgress(b,a,j.loaded,j.total)}};h.onreadystatechange=function(){if(h.readyState==4){g._onComplete(b,h)}};e=e||{};e.qqfile=a;var f=qq.obj2url(e,this._options.action);h.open("POST",f,true);var d=$('meta[name="csrf-token"]').attr("content");if(d){h.setRequestHeader("X-CSRF-Token",d)}h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.setRequestHeader("X-File-Name",encodeURIComponent(a));h.setRequestHeader("Content-Type","application/octet-stream");h.send(c)},_onComplete:function(id,xhr){if(!this._files[id]){return}var name=this.getName(id);var size=this.getSize(id);this._options.onProgress(id,name,size,size);if(xhr.status==200){this.log("xhr - server response received");this.log("responseText = "+xhr.responseText);var response;try{response=eval("("+xhr.responseText+")")}catch(err){response={}}this._completed_files.push({file:this._files[id],response:response});this._options.onComplete(id,name,response)}else{this._completed_files.push({file:this._files[id],response:{}});this._options.onComplete(id,name,{})}this._files[id]=null;this._xhrs[id]=null;this._dequeue(id)},_cancel:function(a){this._options.onCancel(a,this.getName(a));this._files[a]=null;if(this._xhrs[a]){this._xhrs[a].abort();this._xhrs[a]=null}}});(function(){if(typeof window.Isport!=="undefined"){return}var a={};a.WidgetCollection=function(){this.initialized=false;this.collection={};this.eventsContainer=$({})};a.WidgetCollection.prototype.add=function(c,b){$.extend(b.prototype,a.BaseWidget);this[c]=this.collection[c]=new b();if(this.initialized){this.collection[c].start()}};a.WidgetCollection.prototype.remove=function(b){delete this.collection[b]};a.WidgetCollection.prototype.init=function(){this.initialized=true;for(var b in this.collection){if(typeof this.collection[b].start!=="undefined"){this.collection[b].start()}}};a.WidgetCollection.prototype.subscribe=function(e,d,b){var c=e.split(" ");for(var e in c){this.eventsContainer.bind(c[e],$.proxy(d,b))}};a.WidgetCollection.prototype.publish=function(c,b){this.eventsContainer.trigger(c,b)};a.BaseWidget={require:function(b){this[b]=a.widgets[b]}};a.widgets=new a.WidgetCollection();window.Isport=a})();$(document).ready(function(){Isport.widgets.init()});(function(){var a=function(){var b=this;this.start=function(){this.badge=$("#notification_badge");this.badgeLink=this.badge.find("a");this.documentBody=$(document.body);this.dropdown=$("#notification_dropdown");this.dropdownNotifications=this.dropdown.find(".notifications");this.ajaxLoader=this.dropdown.find(".ajax_loader");this.badgeLink.toggle(function(c){c.preventDefault();c.stopPropagation();b.ajaxLoader.show();b.badgeLink.removeClass("red_tab").addClass("gray_tab");b.dropdown.css("display","block");b.getNotifications(function(){b.renderNotifications()})},function(c){c.preventDefault();c.stopPropagation();b.badgeLink.removeClass("gray_tab").addClass("red_tab");b.dropdown.css("display","none")});this.dropdown.click(function(c){c.stopPropagation()});this.documentBody.click(function(c){if(b.dropdownShowing()){b.badgeLink.click()}})};this.dropdownShowing=function(){return this.dropdown.css("display")==="block"};this.getNotifications=function(c){$.getJSON("/notifications",function(d){b.notifications=d;c.apply(b,[])})};this.renderNotifications=function(){b.dropdownNotifications.empty();$.each(b.notifications.notifications,function(d,c){$.each(c,function(e,f){var g=$("<div/>").addClass("notification_element").html(f.translation).prepend($("<img/>",{src:f.actor.person.image_url,"class":"avatar"})).append("<br />").append($("<abbr/>",{"class":"timeago",title:f.created_at})).appendTo(b.dropdownNotifications);g.addClass("unread");if(f.unread){$.ajax({url:"/notifications/"+f.id,type:"PUT",success:function(){message_count=$("#notification_badge .message_count");count=parseInt(message_count.html())||0;count=count-1;if(count>0){message_count.text(count)}else{message_count.remove()}}})}})});$("abbr.timeago").timeago();b.ajaxLoader.hide()}};Isport.widgets.add("notificationDropdown",a)})();(function(b){b.fn.autoResize=function(a){var d={resize:null,animateOptions:{duration:100}};if(a){b.extend(d,a)}this.filter("textarea").each(function(){var c=b(this).css({"overflow-y":"hidden",resize:"none"});var j=c.height(),k=j,i=(function(){var e=c.clone().attr("tab-index",-1).removeAttr("id").removeAttr("name").css({position:"absolute",top:0,left:-9999});return e.insertBefore(c)})();var l=function(){var e=c.val();i.height(0).val(e).scrollTop(9999);var f=Math.max(j,i.scrollTop());if(f===k){return}k=f;if(b.isFunction(d.resize)){d.resize.call(this)}if(d.animateOptions){c.animate({height:f},d.animateOptions)}else{c.height(f)}};c.unbind(".resize").bind("keyup.resize keydown.resize change.resize",l)});return this}})(jQuery);