processPost(<%= @status_message.id %>,"<%= escape_javascript(render(:partial => 'status_messages/status_message_element', :locals => { :post => @status_message}))%>");

function processPost(postId,html){  
    if ($( ".stream_element[id='"+postId+"']" ).length == 0){
      posts = $( ".post_element_panel" );
      prevPosts =  posts.find( ".stream_element" );
      if(prevPosts.length > 0 ){
        prevPosts.first().before(
          $(html).fadeIn("fast", function(){})
        );
       }else{
        posts.html(
          $(html).fadeIn("fast", function(){})
        );
       }
      textarea = $( ".new_status_message textarea");
      textarea.val("");
      $("#contacts").val("");
      Mention.clear();
      $( ".pic_box" ).hide();
      $(".pic_box #photozone .photo").remove(); 
      $( ".pic_box .upload_img_link" ).remove();
      $(".pic_box #photozone input").remove(); 
      if($( ".pic_box .qq-uploader" ).hasClass( "upload_more_pic" )){
        $( ".pic_box .qq-uploader" ).removeClass("upload_more_pic");
        $( ".pic_box .upload_link" ).removeClass("upload_link").addClass("qq-upload-button").find("span").html("选择图片");
        $( ".pic_box .qq-upload-drop-area").css( "visibility","visible" );
      }
      createPostCallBack();
    }      
}


