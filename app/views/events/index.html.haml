- content_for :head do
  = include_stylesheets :sepcial_pages_events_index, :media => 'all'
  = include_stylesheets :sepcial_pages_events_common, :media => 'all'

#city_select_box.hide    
  - City.all.each do |city|
    %h4.inline= link_to city.name, "/events/?city=#{city.pinyin}"

.span-24
  %h2.title
    = '活动:'
    = link_to @city.name , 'javascript:void(0);', :id => 'switch_city'
  %hr

%h4='本周热门:'
.span-24.hot_box
  %h2
  .hot_events
    #slider
      %ul
        -@hot_events.each do |e|
          %li
            = render 'hot_events', :event => e    
    %span#preBtn= link_to left_arrow, 'javascript:void(0);'
    %span#nextBtn= link_to right_arrow, 'javascript:void(0);'

%hr.space
%hr.space
%h4='寻找感兴趣的活动:'
.span-24.hot_box
  %h2
  .hot_events
    .search_line
      .filter_title
        %strong=link_to '活动', 'javascript:void(0);'
      .filter_items
        = link_to '全部', event_filter_path(:city => @city.pinyin)
                         
        - Item.all.each do |i|
          = link_to i.name, event_filter_path(@city.pinyin,@district_id, i.id, @time)
    .search_line
      .filter_title
        %strong=link_to '区域', 'javascript:void(0);' 
      .filter_items
        = link_to '全部', event_filter_path(:city => @city.pinyin, :item_id => @item_id, :time => @time)
        - @city.districts.each do |d| 
          = link_to d.name, event_filter_path(@city.pinyin, d.id, @item_id, @time)
    .search_line
      .filter_title
        %strong=link_to '时间', 'javascript:void(0);' 
      .filter_items
        = link_to '全部', event_filter_path(@city.pinyin, @district_id, @item_id, 'alltime')
        = link_to '今天', event_filter_path(@city.pinyin, @district_id, @item_id, 'today')
        = link_to '本周', event_filter_path(@city.pinyin, @district_id, @item_id, 'week')
        = link_to '周末', event_filter_path(@city.pinyin, @district_id, @item_id, 'weekends')
        = link_to '一个月内', event_filter_path(@city.pinyin, @district_id, @item_id, 'week')
        = link_to '时间选择', 'javascript:void(0)'

%hr.space
%hr.space
%h4='推荐活动:'
.span-24.hot_box
  %h2
  .hot_events
    -@hot_items.each do |i|
      .hot_items_events
        .item_avatar
          = item_image_link(i, :size => :thumb_large)
        - i.events.at_city(@city.id).limit(4).each do |e|
          .item_event
            = event_image_link(e, :thumb_large)
            = e.title
        = link_to '更多', event_filter_path(:city => @city.pinyin, :item_id => i.id), :class => 'right'
      %hr


:javascript
  $(function() {
    var left = $('#switch_city').offset().left;
    var t =$('#switch_city').offset().top + $('#switch_city').innerHeight();
    $('#city_select_box').css("left", left+"px");
    $('#city_select_box').css("top", t+"px");
  });
  
  $('#nextBtn').bind('click', slideRight);
  $('#preBtn').bind('click', slideLeft);

  function slideLeft() {
    $('#preBtn').unbind('click');
    var left = $('#slider ul').css('marginLeft');
    if(left == '0px') {
        $('#slider ul li:last').after($('#slider ul li:first'));
        $('#slider ul').css('marginLeft', '-1816px');
        $('#slider ul').animate({marginLeft: '-908px'}, 300, function(){ 
          $('#preBtn').bind('click', slideLeft);
        });
    } else if(left == '-908px') {
      $('#slider ul').animate({marginLeft: '0px'}, 300, function(){
        $('#preBtn').bind('click', slideLeft);
       });
    } else {
      $('#slider ul').animate({marginLeft: '-908px'}, 300, function(){
        $('#preBtn').bind('click', slideLeft);
      });
    }
  }

  function slideRight() {
    $('#nextBtn').unbind('click');
    var left = $('#slider ul').css('marginLeft');
    if(left == '0px') {
      $('#slider ul').animate({marginLeft: '-908px'}, 300, function(){
        $('#nextBtn').bind('click', slideRight);
       });
    } else if(left == '-908px') {
      $('#slider ul').animate({marginLeft: '-1816px'}, 300, function(){
        $('#nextBtn').bind('click', slideRight);
      });
    } else {
      $('#slider ul li:first').before($('#slider ul li:last'));
      $('#slider ul').css('marginLeft', '0px');
      $('#slider ul').animate({marginLeft: '-908px'}, 300, function(){
        $('#nextBtn').bind('click', slideRight);
      });
    }
  }

  $("#switch_city").click(function(e) {
    $('#city_select_box').toggleClass('hide'); 
    e.stopPropagation();
    return false;
  });
