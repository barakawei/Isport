-content_for :head do
  = include_stylesheets :sepcial_pages_events_show, :media => 'all'
  = include_javascripts :google_map
  =javascript_include_tag "http://maps.google.com/maps/api/js?sensor=false"
.span-24
  .span-24
    .span-17
      %h2.title= @event.title
    .span-7.last
      = link_to t('back'),  events_path, :class => "button right"
      - if @event.is_owner(current_user)
        = link_to t('events.edit_event'), edit_event_path(@event), :class => "button right edit_event"
    %hr
  .span-17
    - if @page <= 1
      .span-5.event_pic
        = event_image_tag(@event, :thumb_large)
      .span-8.last.event_info
        %p
          %b= t('events.start_at')+":"
          = l(@event.start_at, :format => :long)
        %p
          %b= t('events.end_at')+":"
          = l(@event.end_at, :format => :long)
        %p
          %b= t('events.location')+":"
          = @event.location
        %p
          %b= t('events.event_subject')+":"
          = link_to @event.item.name, item_path(@event.item)
        %p
          %b= t('events.event_owner')+":"
          = link_to @event.person.profile.name, person_path(@event.person)
        %p
          %b= t('activerecord.attributes.event.participants_limit')+":"
          = @event.participants_limit
          %b= ",  " + t('events.remained_participants')
          = @event.participants_limit - @event.participants.size
      .span-3.last.left_border
        = event_application_link(@event) 
        - unless is_reference_of(@event)
          %p.bottom
            = link_to t('events.recommend'), 
                      url_for(:controller => "event_recommendations",:action => "add_reference",
                              :id => @event.id), :class => "button" 
        -else
          %br
          %h4.top= t('events.recommended') 
          %p.bottom
          = link_to t('events.cancel_recommend'), 
                    url_for(:controller => "event_recommendations", :action => "remove_reference",
                            :id => @event.id), :class => "button"
      .span-16.last.append-bottom
        %br
        %h4= t('events.event_description')+":"
        %hr
        %p= simple_format(@event.description)
        %hr
    .span-16.last.comments_area.prepend-top
      %h4= t('events.event_comments')+":"
      = render :partial => "event_comments",  :locals => { :event => @event,
                                                     :author => @person,
                                                     :comments => @comments,
                                                     :comment => @comment}
  - if @page <= 1
    .span-6.prepend-1.last
      .span-6
        %h4.blue
          ='活动地图:'
          = link_to "(详细)", event_map_path(@event)
        #map
      - if @event.participants.size > 0
        %h4
          = t('events.total') 
          = link_to "#{@event.participants.size}"+ t('events.person'),
            url_for(:action => "show_participants", :id => @event.id), :class => "nounderline"
          = t('events.involvement')
        = render :partial => 'event_participants', :locals => { :participants => @participants, 
                                                                :perline => 3, :no_pagination => true,  
                                                                :edit => false }
      .span-6.last.prepend-top
        -if @event.references.size > 0 
          %h4
            = t('events.total')
            = link_to "#{@event.references.size}" + t('events.person'),
              url_for(:action => "show_references", :id => @event.id), :class => "nounderline"
            = t('events.recommendation')
          = render :partial => 'event_references', :locals => { :references => @references, 
                                                                :perline => 3, :no_pagination => true } 

:javascript
  $(function() {
    $('.edit_event').button({
      icons: {
        primary: 'ui-icon-pencil'
      } 
    });

    var address = "#{@event.location}";
    codeAddress("map", address);
  });

